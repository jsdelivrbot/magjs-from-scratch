/*
Mag.JS AddOns v0.23.5
http://github.com/magnumjs/mag.js
(c) Michael Glazer
License: MIT
*/
!function(a,b,c,d){"use strict";function e(a,b){for(var c=Object.keys(a),d=0,e=c.length;d<e;++d){var f=c[d];b(f,a[f])}}function f(a){return a.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}a.create=function(b,c,d){return function(e,f){return"string"==typeof e||a.utils.isHTMLEle(e)||(f=e,e=0),a.module(e||b,c,a.merge(a.copy(d)||{},a.copy(f)||{}))}},a.template=function(b,c){var d=b;return"prod"==a.ENV&&(d={url:b,cache:1}),a.request(d).then(function(b){var d=a.html2dom(b);return c&&c(d),d})},a.html2dom=function(b){var c=a.doc.createElement("template");return c.innerHTML=b,c.content.children[0]},a.getTags=function(b){var c=a.utils.items.getItemVal(a.mod.runningViewInstance),d=a.getNode(c),e=(d||a.doc).getElementsByTagName(b),f=[].slice.call(e);return f},a.tag=function(b,c,d,e){var f=a.getTags(b),g=[];if(e=e||"module",f.length)for(var h of f)g.push(a[e](h,c,d));return 1==g.length?g[0]:g},a.noop=function(){},a.copy=a.utils.copy,a.merge=a.utils.merge,a.isEmpty=function(a){if(!a||0==a.length)return!0;if("Object]"==a.toString().substr(-7)){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0}return a.trim()},a.show=function(b,c){var d=typeof b;if("object"!==d){var e={_config:function(a){a.style.display=b?"block":"none"}};return"object"==typeof c&&a.merge(c,e),e}"object"==d?b.willload=function(a,b){a.style.display="block"}:b.willupdate=function(a,b){a.style.display=b[c]?"block":"none"}},a.deferred=function(){var a={};return a.promise=new Promise(function(b,c){a.resolve=b,a.reject=c}),a},a.when=function(a,b){return Promise.all(a).then(b)},a.request=function(b){if("string"==typeof b){var c=b;b={},b.url=c}var d=a.deferred();b.initialValue&&(d.promise.initialValue=b.initialValue);var e=JSON.stringify(b);if(b.cache){var f=a.cache(e);if(f)return d.resolve(f),d.promise}if(a.request.queue[e])return a.request.queue[e];a.request.queue[e]=d.promise;var g=new XMLHttpRequest,h=(b.method||"GET").toUpperCase(),i="GET"!==h&&b.data?"object"==typeof b.data?JSON.stringify(b.data):b.data:"";if(g.onload=function(c){var f=g.getResponseHeader("content-type")||"",h=c.target.responseText;f.indexOf("json")>-1&&(h=JSON.parse(h)),b.cache&&a.cache(e,h,b.cacheTime,b.cacheType),delete a.request.queue[e];var i=g.getAllResponseHeaders();d.resolve(h,i)},g.onerror=function(a){d.reject(a)},g.open(h,b.url),b.withCredentials&&(g.withCredentials=b.withCredentials),b.headers)for(var j=0;j<b.headers.length;j++){var k=b.headers[j];for(var l in k)g.setRequestHeader(l,k[l])}return g.send(i),d.promise},a.request.queue={},a.cache=function(c,d,e,f){var g=b[f||"sessionStorage"];if(1==arguments.length){if(a.cache.data[c])return a.cache.data[c].data;var h=g.getItem(c);return h?(a.cache.data[c]=JSON.parse(h),a.cache.data[c].data):0}a.cache.data[c]&&a.cache.data[c].id&&clearTimeout(a.cache.data[c].id);var i=setTimeout(function(b){g.removeItem(b),delete a.cache.data[b]}.bind({},c),e||6e5);a.cache.data[c]={id:i,data:d},g.setItem(c,JSON.stringify(a.cache.data[c]))},a.cache.data={},a.requestWithFeedback=function(b){var d=JSON.stringify(b);if(!a.requestWithFeedback.cache[d]){for(var g,e=c.querySelectorAll(".loader"),f=0;g=e[f];f++)g.style.display="block";var h=function(b){if(delete a.requestWithFeedback.cache[d],0==Object.keys(a.requestWithFeedback.cache).length)for(var f,c=0;f=e[c];c++)f.style.display="none";return b};a.requestWithFeedback.cache[d]=a.request(b),a.requestWithFeedback.cache[d].then(h,function(a){throw h(a),a})}return a.requestWithFeedback.cache[d]},a.requestWithFeedback.cache={},a.disable=function(b,c){var d=c&&c._config?c._config:function(){},e={_config:function(a){d.apply(this,arguments),b()?a.setAttribute("disabled","disabled"):a.removeAttribute("disabled")}};return c&&a.merge(c,e),e},a.find=function(b,d){var e=c.getElementById(b);return a.fill.find(e,d)},a.toMenu=function(a,b){return a.map(function(a,c){return{_text:a,_value:c,_selected:b===c||b===a||null}})},a.namespace=function(b,c){var d=b.split("."),e=d.shift();return c=c||this,c[e]=c[e]||{},d.length?a.namespace(d.join("."),c[e]):c[e]},a.route=function(a){function c(a,c){b.push({parts:a.split("/"),handler:c})}function e(b){a.location.hash=b}function f(){for(var c=a.location.hash.substr(1),e=c.split("/"),f=e.length,g=0;g<b.length;g++){var h=b[g];if(h.parts.length===f){for(var i=[],j=0;j<f;j++)if(":"===h.parts[j].substr(0,1))i.push(e[j]);else if(h.parts[j]!==e[j])break;if(j===f)return void h.handler.apply(d,i)}}}var b=[];return a.onhashchange=f,{addRoute:c,load:e,start:f}}(b),a.hookin("attributes","key",function(a){a.value=null});var g={opacity:1,zIndex:1,float:1,fontWeight:1,gridColumn:1,lineHeight:1,transform:1,zoom:1};a.hookin("attributes","style",function(a){if("object"==typeof a.value){var b=a.node.getAttribute("style")||"",c="";e(a.value,function(a,b){c+=f(a)+":"+(isNaN(b)||a in g?b:b+"px")+";"}),b&&~b.indexOf(c)?a.value=b:a.value=b+c}}),a.hookin("attributes","className",function(a){a.key="class";var b=a.value,c=a.node.classList+"";if("string"==typeof a.value)b=a.value.split(" ");else if("object"==typeof a.value){for(var d in b)a.node.classList.toggle(d,"undefined"!=typeof b[d]&&b[d]);return void(a.value=a.node.classList+"")}a.value=a.node.classList+"";for(var d in b){var e=b[d];e.trim()&&a.node.classList.length>0&&!a.node.classList.contains(e.trim())?a.value=a.node.classList+" "+e:e.trim()&&0==a.node.classList.length&&(a.value+=e+" ")}a.value.trim()!==c&&(a.change=1),a.value=a.value.trim()});var h=[];a.hookin("values","*",function(b){var c=typeof b.value;null==b.value||("function"===c&&b.value.toJSON?(b.change=1,b.value=b.value()):"object"==c&&"function"==typeof b.value.then&&(h[a.fill.id+b.key]||(h[a.fill.id+b.key]=1,b.value.then(function(c,d,e){if(c){var f=a.utils.items.getItem(c);~f&&(a.mod.getState(f)[d]=e,a.redraw(a.getNode(c),f),h[c+b.key]=0)}return e}.bind(null,a.fill.id,b.key))),b.value.initialValue&&(b.change=1,b.value=b.value.initialValue)))}),a.getId=function(b){return a.utils.items.getItemVal(b)},a.prop=function(a){var b=function(){return arguments.length&&(a=arguments[0]),a};return b.toJSON=function(){return a},b},a.withProp=function(a,b){return function(c){c=c||event;var d=c.currentTarget||this;b(a in d?d[a]:d.getAttribute(a))}}}(mag,window||global||this,document);
